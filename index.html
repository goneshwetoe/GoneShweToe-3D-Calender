<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>GoneShweToe â€“ Myanmar 3D Lottery Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        primary: '#2563eb',
        accent: '#f59e0b'
      }
    }
  }
}
</script>

<style>
.cell { transition: all .15s ease; }
.cell:hover { filter: brightness(.95); }
.cell:active { transform: scale(1.05); }
.modal-bg { backdrop-filter: blur(4px); }
</style>
</head>

<body class="bg-slate-100 dark:bg-slate-900 text-slate-900 dark:text-slate-100">

<header class="sticky top-0 z-50 bg-white dark:bg-slate-800 shadow">
  <div class="max-w-6xl mx-auto p-4 flex justify-between items-center">
    <div>
      <h1 class="text-xl font-black text-primary">GoneShweToe</h1>
      <p class="text-xs opacity-60">Myanmar 3D Lottery Calendar</p>
    </div>
    <button id="darkToggle" class="px-3 py-1 text-sm rounded bg-slate-200 dark:bg-slate-700">ğŸŒ™</button>
  </div>
</header>

<main class="max-w-6xl mx-auto p-4 space-y-4">

<section id="welcome" class="bg-blue-50 dark:bg-slate-800 border rounded-xl p-4 text-sm">
ğŸ‘‹ <b>Welcome!</b> Tap any number to add your personal note.  
<div class="opacity-60">Your data is saved on this device only.</div>
</section>

<section class="grid grid-cols-1 sm:grid-cols-3 gap-3">
  <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow">
    <div class="text-xs opacity-60">ğŸ”¥ Hot</div>
    <div id="hot" class="font-bold text-lg">â€“</div>
  </div>
  <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow">
    <div class="text-xs opacity-60">â„ Cold</div>
    <div id="cold" class="font-bold text-lg">â€“</div>
  </div>
  <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow">
    <div class="text-xs opacity-60">ğŸ”¢ Frequent</div>
    <div id="freq" class="font-bold text-lg">â€“</div>
  </div>
</section>

<section class="bg-white dark:bg-slate-800 rounded-xl shadow overflow-auto">
<table class="border-collapse w-full text-sm">
<thead class="bg-slate-50 dark:bg-slate-700 sticky top-0">
<tr id="yearRow">
<th class="p-2 sticky left-0 bg-slate-50 dark:bg-slate-700">Round</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</section>

<div class="text-center text-xs opacity-60">
â„¹ Tap number to edit â€¢ Historical data only
</div>

<button onclick="exportUserData()" class="text-xs underline block mx-auto">
Export My Data
</button>

</main>

<footer class="text-center text-xs opacity-60 p-4">
Â© 2025 GoneShweToe
</footer>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 hidden items-end sm:items-center justify-center modal-bg bg-black/40">
<div class="bg-white dark:bg-slate-800 w-full sm:w-96 rounded-t-xl sm:rounded-xl p-4">
<h3 class="font-bold mb-2">Edit</h3>
<input id="colorInput" type="color" class="w-full h-10 mb-2"/>
<textarea id="noteInput" class="w-full border rounded p-2 dark:bg-slate-700" placeholder="Note..."></textarea>
<div class="flex justify-end gap-2 mt-3">
<button onclick="closeModal()">Cancel</button>
<button onclick="saveModal()" class="bg-primary text-white px-3 py-1 rounded">Save</button>
</div>
</div>
</div>

<script>
const DATA_URL = "./data/public_data.json";
const KEY = "gst_user";
let userData = JSON.parse(localStorage.getItem(KEY) || "{}");
let currentId=null;
let DATA=[];

fetch(DATA_URL).then(r=>r.json()).then(d=>{
DATA=d;
render();
});

function render(){
const years=[...new Set(DATA.map(d=>new Date(d.date).getFullYear()))];
const map={};
years.forEach(y=>map[y]=Array(24).fill(""));

DATA.forEach(d=>{
const dt=new Date(d.date);
const r=dt.getMonth()*2+(dt.getDate()>1?1:0);
map[dt.getFullYear()][r]=d.number;
});

years.forEach(y=>{
const th=document.createElement("th");
th.textContent=y;
th.className="p-2";
yearRow.appendChild(th);
});

for(let r=0;r<24;r++){
const tr=document.createElement("tr");
tr.innerHTML=`<td class="p-2 sticky left-0 bg-white dark:bg-slate-800 font-bold">${r+1}</td>`;
years.forEach(y=>{
const id=`${y}-${r}`;
const td=document.createElement("td");
td.className="p-2 text-center cell cursor-pointer";
td.textContent=map[y][r]||"â€”";
if(userData[id]?.color) td.style.background=userData[id].color;
td.onclick=()=>openModal(id);
tr.appendChild(td);
});
tableBody.appendChild(tr);
}

// INSIGHT
const nums=DATA.map(d=>d.number).join("");
const freq={};
nums.split("").forEach(d=>freq[d]=(freq[d]||0)+1);
const sorted=Object.entries(freq).sort((a,b)=>b[1]-a[1]);
hot.textContent=DATA.slice(-3).map(d=>d.number).join(", ");
cold.textContent=Object.keys(freq).filter(d=>!nums.slice(-6).includes(d)).join(", ");
freqEl.textContent=sorted[0]?.[0]||"-";
}

function openModal(id){
currentId=id;
modal.classList.remove("hidden");
colorInput.value=userData[id]?.color||"#f59e0b";
noteInput.value=userData[id]?.note||"";
}
function closeModal(){modal.classList.add("hidden");}
function saveModal(){
userData[currentId]={color:colorInput.value,note:noteInput.value};
localStorage.setItem(KEY,JSON.stringify(userData));
location.reload();
}

function exportUserData(){
const blob=new Blob([JSON.stringify(userData)],{type:"application/json"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="goneshwetoe_backup.json";
a.click();
}

// Dark
darkToggle.onclick=()=>{
document.documentElement.classList.toggle("dark");
localStorage.setItem("dark",document.documentElement.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true") document.documentElement.classList.add("dark");

// Welcome
if(localStorage.getItem("welcome")) welcome.style.display="none";
else localStorage.setItem("welcome","1");

// Service Worker
if("serviceWorker" in navigator){
navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>